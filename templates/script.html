{% extends "fragment-base.html" %}

{% block body %}

<form method="post" action="/api/scripts" onsubmit="submitString(event, '#script', 'application/yaml')">
    <fieldset class="uk-fieldset">
        <div class="space-y-2">
            <label class="block text-sm font-medium text-gray-700">Script</label>
            <textarea class="uk-textarea w-full p-2 border rounded" id="script" placeholder="..."
                rows="15">{% if script.is_some() %}{{ script.unwrap() }}{% endif %}</textarea>
        </div>


        <div class="uk-margin">
            <button class="uk-button uk-button-primary">Submit</button>
        </div>
    </fieldset>
</form>

<script>
    const errorClasses = ['error-border']
    document.addEventListener("DOMContentLoaded", (event) => {
        document.getElementById('script').addEventListener('change', function (e) {
            let anyError = false;
            let content = null;
            try {
                content = window.globalThis.jsyaml.load(this.value);
            } catch (error) {
                anyError = true;
            }

            if (anyError) {
                this.classList.add(...errorClasses);
                this.setAttribute('aria-invalid', 'true');
            } else {
                this.classList.remove(...errorClasses);
                this.removeAttribute('aria-invalid');
            }
        });
    });

</script>

{% endblock %}